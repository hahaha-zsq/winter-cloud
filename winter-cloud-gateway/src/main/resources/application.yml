server:
  port: 9997
spring:
  application:
    name: winter-cloud-gateway
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacos æœåŠ¡å™¨åœ°å€
        namespace: ccfca4f0-0131-497a-95a1-3732131d59a8  # å‘½åç©ºé—´ï¼ˆå¯é€‰ï¼Œç”¨äºç¯å¢ƒéš”ç¦»ï¼‰
        group: DEFAULT_GROUP  # åˆ†ç»„ï¼ˆå¯é€‰ï¼‰
        username: nacos  # Nacos ç”¨æˆ·åï¼ˆå¦‚æœå¼€å¯äº†è®¤è¯ï¼‰
        password: nacos  # Nacos å¯†ç ï¼ˆå¦‚æœå¼€å¯äº†è®¤è¯ï¼‰
    gateway:

      # 1. å…¨å±€è·¨åŸŸé…ç½® (æ–°å¢éƒ¨åˆ†)
      globalcors:
        add-to-simple-url-handler-mapping: true # è§£å†³ OPTIONS è¯·æ±‚è¢«æ‹¦æˆªé—®é¢˜
        cors-configurations:
          '[/**]':
            allowed-origin-patterns: # ğŸ‘ˆ æ³¨æ„æ˜¯ patternsï¼Œä¸æ˜¯ origins
              - "http://localhost:*"
            allowedMethods: "*"         # å…è®¸æ‰€æœ‰æ–¹æ³•
            allowedHeaders: "*"         # å…è®¸æ‰€æœ‰å¤´
            allowCredentials: true      # å…è®¸æºå¸¦ Cookie
      # è·¯ç”±é…ç½®
      routes:
        # è®¤è¯æœåŠ¡è·¯ç”±
        - id: winter-cloud-auth
          uri: lb://winter-cloud-auth
          predicates:
            - Path=/api/**
          filters:
            - StripPrefix=1
            - name: Retry
              args:
                retries: 1  # å‡å°‘é‡è¯•æ¬¡æ•°
                statuses: BAD_GATEWAY,GATEWAY_TIMEOUT
                methods: GET,POST
                backoff:
                  firstBackoff: 50ms
                  maxBackoff: 500ms
        # è®¤è¯æœåŠ¡è·¯ç”±
        - id: winter-cloud-dict
          uri: lb://winter-cloud-dict
          predicates:
            - Path=/api/**
          filters:
            - StripPrefix=1
            - name: Retry
              args:
                retries: 1  # å‡å°‘é‡è¯•æ¬¡æ•°
                statuses: BAD_GATEWAY,GATEWAY_TIMEOUT
                methods: GET,POST
                backoff:
                  firstBackoff: 50ms
                  maxBackoff: 500ms
  redis:
    host: localhost
    port: 6379
    password: redis
    database: 0
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
        max-wait: -1ms

# Dubbo é…ç½®
dubbo:
  application:
    name: winter-cloud-gateway-dubbo
    qos-enable: true
    qos-port: 22223
    qos-accept-foreign-ip: false
  registry:
    address: nacos://localhost:8848
    parameters:
      namespace: ccfca4f0-0131-497a-95a1-3732131d59a8
      group: DEFAULT_GROUP
      username: nacos
      password: nacos
  protocol:
    name: dubbo
    port: 20881
  consumer:
    timeout: 3000
    retries: 0
    check: false  # å¯åŠ¨æ—¶ä¸æ£€æŸ¥æä¾›è€…æ˜¯å¦å­˜åœ¨

winter-redis-config:
  # ç³»ç»Ÿåç§°ï¼Œç”¨äºåŠ¨æ€é…ç½®ä¸­å¿ƒçš„å‘½åç©ºé—´éš”ç¦»
  system: ${spring.application.name}

  # Redisson è¿æ¥é…ç½®
  redission:
    host: ${spring.redis.host}
    port: ${spring.redis.port}
    database: ${spring.redis.database}
    password: ${spring.redis.password}
    pool-size: 64            # è¿æ¥æ± å¤§å°
    min-idle-size: 10        # æœ€å°ç©ºé—²è¿æ¥æ•°
    idle-timeout: 10000      # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    connect-timeout: 10000   # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    retry-attempts: 3        # é‡è¯•æ¬¡æ•°
    retry-interval: 1500     # é‡è¯•é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    ping-interval: 30000     # Ping è¿æ¥é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    keep-alive: true         # æ˜¯å¦ä¿æŒè¿æ¥
logging:
  level:
    com.winter.cloud.gateway: debug
    com.baomidou.dynamic: debug  # åŠ¨æ€æ•°æ®æºæ—¥å¿—
    reactor.netty: debug  # Nettyæ—¥å¿—
    org.springframework.cloud.gateway: debug  # Gatewayæ—¥å¿—
#    org.apache.dubbo: debug  # Dubboæ—¥å¿—
